pipeline {
    agent any
    // triggers {
    //     pollSCM('H * * * *')
    // }
    options {
        // 병렬 빌드 금지 → 동일 Job은 항상 직렬실행
        disableConcurrentBuilds()
        timestamps()
    }
    stages {
        stage('Clean Workspace') {
            steps {
                deleteDir()
            }
        }
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        stage('Read README File') {
            steps {
                script {
                    def readme = readFile('README.md')
                    currentBuild.description = "${readme}"
                }
            }
        }
        stage('Package') {
            steps {
                powershell '''
                $zipName = "py_image_analysis_uv_${env:BUILD_NUMBER}.zip"
                $items = Get-ChildItem -LiteralPath . -Force
                Compress-Archive `
                    -Path $items `
                    -DestinationPath $zipName `
                    -Force
                '''
            }
        }
    }
    post {
        always {
            archiveArtifacts artifacts: '*.zip, README.md',fingerprint: true
            // archiveArtifacts artifacts: 'xilinx_fifo_test.runs/impl_1/*.bit', fingerprint: true
        }
    }
}